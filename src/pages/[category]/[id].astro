---
import Layout from '../../layouts/Layout.astro'
import FormattedDate from '../../components/FormattedDate.astro'
import { getCollection, render } from 'astro:content'
import Prose from '../../components/Prose.astro'
import { getCategorySlug } from '../../lib/utils'

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
    const blogEntries = await getCollection('blog')

    return blogEntries.map((entry) => ({
        params: {
            category: getCategorySlug(entry.data.category),
            id: entry.data.slug,
        },
        props: { entry },
    }))
}
// 2. For your template, you can get the entry directly from the prop
const { entry } = Astro.props
const { Content } = await render(entry)
---

<Layout title={entry.data.title}>
    <main class="bg-base-100 rounded-2xl p-4 shadow-md lg:p-8">
        <div class="mb-16 lg:max-w-5xl">
            <nav class="text-base-content/80 mb-6 text-sm">
                <a href="/" class="hover:text-primary transition-colors">Home</a>
                <span class="mx-2">/</span>
                <a
                    href={`/${getCategorySlug(entry.data.category)}`}
                    class="hover:text-primary capitalize transition-colors"
                >
                    {entry.data.category}
                </a>
            </nav>

            <h1
                class="text-base-content mb-4 text-4xl leading-tight font-bold md:text-5xl lg:text-6xl"
            >
                {entry.data.title}
            </h1>

            <div
                class="text-base-content/70 mb-6 flex flex-wrap items-center gap-4 text-sm font-medium"
            >
                <div class="flex items-center gap-2">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="1em"
                        height="1em"
                        viewBox="0 0 24 24"
                        class="opacity-50"
                    >
                        <path
                            fill="currentColor"
                            d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"
                        ></path>
                        <path
                            fill="currentColor"
                            d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2M19 8l.001 12H5V8z"
                        ></path>
                    </svg>
                    <FormattedDate date={entry.data.pubDate} />
                </div>

                <span class="opacity-30">â€¢</span>

                <div class="capitalize">
                    {entry.data.category}
                </div>
            </div>

            {
                entry.data.tags && entry.data.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2">
                        {entry.data.tags.map((tag) => (
                            <a
                                href={`/tag/${tag}`}
                                class="bg-base-200 hover:bg-primary rounded-full px-3 py-1 text-xs transition-colors duration-200 hover:text-white"
                            >
                                {tag}
                            </a>
                        ))}
                    </div>
                )
            }

            <div class="border-base-300 mt-8 mb-12 border-t"></div>
        </div>

        <Prose>
            <Content />
        </Prose>
    </main>
</Layout>
