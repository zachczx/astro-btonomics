---
import Layout from '../layouts/Layout.astro'
import { Image } from 'astro:assets'
import headerImage from '../images/36_upload_IMG_20180730_204953_header.jpg'
import headerImage0 from '../images/3_concept1_header-topaz-enhance-4x.webp'
import { GetUniqueTags, CleanAndSort, FilterCleanSort } from '../lib/utils'
import PostList from '../components/PostList.astro'

const allPosts = await CleanAndSort()
const tagsList = await GetUniqueTags(allPosts)
const allHonestReviewsPosts = FilterCleanSort(allPosts, 'honest-reviews')
const allShoppingPosts = FilterCleanSort(allPosts, 'shopping')
const allRenovationPosts = FilterCleanSort(allPosts, 'renovation')
const allMaintenancePosts = FilterCleanSort(allPosts, 'maintenance')
const allGeneralPosts = FilterCleanSort(allPosts, 'general')
---

<Layout title="Home">
    <div slot="hero" class="mt-10 grid w-full grid-cols-2" data-pagefind-ignore>
        <div class="group col-span-2 text-center md:col-span-1">
            <a
                href="/renovation/our-clean-bto-home-design"
                class="relative block overflow-hidden transition-all duration-500"
            >
                <div class="relative h-[50vh] overflow-hidden">
                    <Image
                        src={headerImage0}
                        alt=""
                        loading="eager"
                        widths={[600, 1200, 2000]}
                        class="h-full w-full object-cover object-center opacity-75 transition-all duration-500 group-hover:scale-105"
                        sizes={`(max-width: 768px) 100vw, 50vw`}
                    />
                    <div
                        class="absolute inset-0 bg-linear-to-t from-black/60 via-black/20 to-transparent opacity-70 transition-opacity duration-500 group-hover:opacity-40"
                    >
                    </div>
                    <div class="absolute right-0 bottom-0 left-0 p-6 text-left">
                        <p class="text-lg font-bold text-white drop-shadow-lg">The Design</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="group col-span-2 text-center md:col-span-1">
            <a
                href="/honest-reviews/4-room-bto-design-completed-home"
                class="relative block overflow-hidden transition-all duration-500"
            >
                <div class="relative h-[50vh] overflow-hidden">
                    <Image
                        src={headerImage}
                        alt=""
                        loading="eager"
                        widths={[600, 1200, 2000]}
                        class="h-full w-full object-cover object-center opacity-75 transition-all duration-500 group-hover:scale-105"
                        sizes={`(max-width: 768px) 100vw, 50vw`}
                    />
                    <div
                        class="absolute inset-0 bg-linear-to-t from-black/60 via-black/20 to-transparent opacity-70 transition-opacity duration-500 group-hover:opacity-40"
                    >
                    </div>
                    <div class="absolute right-0 bottom-0 left-0 p-6 text-left">
                        <p class="text-lg font-bold text-white drop-shadow-lg">The Result</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <aside data-pagefind-ignore>
        <nav class="mt-4 grid">
            <div
                id="tags-container"
                class="flex flex-wrap items-center gap-2.5 overflow-hidden text-base transition-[max-height] duration-500 ease-in-out"
                style="max-height: 5rem"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="1.5em"
                    height="1.5em"
                    class="prime:tags text-primary"
                    viewBox="0 0 24 24"
                    ><path
                        fill="currentColor"
                        d="m21.07 10.3l-6-6a.75.75 0 0 0-.53-.22H3c-.41 0-.75.34-.75.75v7.88c0 .2.08.39.22.53l6 5.99a2.3 2.3 0 0 0 1.64.68c.62 0 1.21-.24 1.64-.68l.22-.22c.04.08.08.16.15.22a2.326 2.326 0 0 0 3.29 0l5.65-5.65c.9-.9.9-2.37 0-3.28ZM10.7 18.17c-.16.16-.36.24-.58.24s-.43-.09-.58-.24L3.75 12.4V5.58h6.82l5.78 5.78c.32.32.32.84 0 1.16zm9.31-5.65l-5.65 5.65c-.32.32-.85.32-1.17 0a.7.7 0 0 0-.23-.15l4.44-4.44c.9-.91.9-2.38 0-3.28l-4.72-4.72h1.54L20 11.36c.32.32.32.84 0 1.16ZM8.25 8.5a1.25 1.25 0 1 1-2.5 0a1.25 1.25 0 0 1 2.5 0"
                    ></path></svg
                >
                {
                    tagsList.map((tag) => (
                        <a
                            href={'/tag/' + tag}
                            class="group border-primary/40 bg-primary/10 text-primary hover:border-accent hover:bg-accent/20 hover:text-accent hover:shadow-accent/30 relative overflow-hidden rounded-full border px-4 py-1.5 text-sm font-medium backdrop-blur-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg"
                        >
                            <span class="relative z-10">{tag}</span>
                            <div class="via-accent/20 absolute inset-0 z-0 bg-linear-to-r from-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
                        </a>
                    ))
                }
            </div>
            <div class="mt-2 flex grow justify-center">
                <button
                    id="tags-toggle-btn"
                    class="text-primary hover:text-accent mt-2 hidden cursor-pointer justify-center text-sm font-medium transition-colors focus:outline-hidden"
                >
                    Show more
                </button>
            </div>

            <script>
                const container = document.getElementById('tags-container')
                const btn = document.getElementById('tags-toggle-btn')

                if (container && btn) {
                    const checkOverflow = () => {
                        // If expanded, always show button (unless we want to calc if it fits)
                        // But verifying if it fits while expanded is hard without collapsing.
                        // So we mainly rely on initial/collapsed state check.
                        if (container.style.maxHeight === '5rem') {
                            if (container.scrollHeight > container.clientHeight) {
                                btn.classList.remove('hidden')
                            } else {
                                btn.classList.add('hidden')
                            }
                        } else {
                            // If expanded, update height on resize to prevent cutoff
                            container.style.maxHeight = container.scrollHeight + 'px'
                        }
                    }

                    // Run initially
                    checkOverflow()
                    // Run on resize
                    window.addEventListener('resize', checkOverflow)

                    btn.addEventListener('click', () => {
                        if (container.style.maxHeight === '5rem') {
                            container.style.maxHeight = container.scrollHeight + 'px'
                            btn.textContent = 'Show less'
                        } else {
                            container.style.maxHeight = '5rem'
                            btn.textContent = 'Show more'
                            // Re-check overflow state after collapsing just in case
                            // (We need to wait for transition? No, max-height sets target immediately for overflow check context?
                            // Actually clientHeight changes over transition.
                            // But styling is immediate.
                            // Let's defer slightly or just trust resize handler will catch edge cases.)
                        }
                    })
                }
            </script>
        </nav>
        <main class="pt-12">
            <div class="grid gap-14 lg:grid-cols-2">
                <PostList
                    title="Honest Reviews"
                    url="/honest-reviews"
                    id="honest-reviews"
                    posts={allHonestReviewsPosts}
                />
                <PostList title="Shopping" url="/shopping" id="shopping" posts={allShoppingPosts} />
                <PostList
                    title="Renovation"
                    url="/renovation"
                    id="renovation"
                    posts={allRenovationPosts}
                />
                <PostList
                    title="Maintenance"
                    url="/maintenance"
                    id="maintenance"
                    posts={allMaintenancePosts}
                />
                <PostList title="General" url="/general" id="general" posts={allGeneralPosts} />
            </div>
        </main>

        <style>
            .backgroundGradient {
                background-image: radial-gradient(
                    circle,
                    #e9ffc2,
                    #caffed,
                    #d4ffff,
                    #f1ffff,
                    #ffffff
                );
                background-repeat: no-repeat;
                background-attachment: fixed;
            }
        </style>
    </aside>
</Layout>
